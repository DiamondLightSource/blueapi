{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "Helm Values Schema",
    "description": "Schema for Helm values",
    "type": "object",
    "properties": {
        "affinity": {
            "type": "object",
            "additionalProperties": false
        },
        "debug": {
            "type": "object",
            "properties": {
                "enabled": {
                    "type": "boolean"
                }
            },
            "additionalProperties": false
        },
        "extraEnvVars": {
            "type": "array"
        },
        "fullnameOverride": {
            "type": "string"
        },
        "hostNetwork": {
            "type": "boolean"
        },
        "image": {
            "type": "object",
            "properties": {
                "pullPolicy": {
                    "type": "string"
                },
                "repository": {
                    "type": "string"
                },
                "tag": {
                    "type": "string"
                }
            },
            "additionalProperties": false
        },
        "imagePullSecrets": {
            "type": "array"
        },
        "ingress": {
            "type": "object",
            "properties": {
                "annotations": {
                    "type": "object",
                    "additionalProperties": false
                },
                "className": {
                    "type": "string"
                },
                "enabled": {
                    "type": "boolean"
                },
                "hosts": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "host": {
                                "type": "string"
                            },
                            "paths": {
                                "type": "array",
                                "items": {
                                    "type": "object",
                                    "properties": {
                                        "path": {
                                            "type": "string"
                                        },
                                        "pathType": {
                                            "type": "string"
                                        }
                                    },
                                    "additionalProperties": false
                                }
                            }
                        },
                        "additionalProperties": false
                    }
                },
                "tls": {
                    "type": "array"
                }
            },
            "additionalProperties": false
        },
        "initContainer": {
            "type": "object",
            "properties": {
                "enabled": {
                    "type": "boolean"
                },
                "persistentVolume": {
                    "type": "object",
                    "properties": {
                        "enabled": {
                            "type": "boolean"
                        },
                        "existingClaimName": {
                            "type": "string"
                        }
                    },
                    "additionalProperties": false
                }
            },
            "additionalProperties": false
        },
        "initResources": {
            "type": "object",
            "additionalProperties": false
        },
        "livenessProbe": {
            "type": "object",
            "properties": {
                "failureThreshold": {
                    "type": "integer"
                },
                "httpGet": {
                    "type": "object",
                    "properties": {
                        "path": {
                            "type": "string"
                        },
                        "port": {
                            "type": "string"
                        }
                    },
                    "additionalProperties": false
                },
                "periodSeconds": {
                    "type": "integer"
                }
            },
            "additionalProperties": false
        },
        "nameOverride": {
            "type": "string"
        },
        "nodeSelector": {
            "type": "object",
            "additionalProperties": false
        },
        "podAnnotations": {
            "type": "object",
            "additionalProperties": false
        },
        "podLabels": {
            "type": "object",
            "additionalProperties": false
        },
        "podSecurityContext": {
            "type": "object",
            "additionalProperties": false
        },
        "readinessProbe": {
            "type": "object",
            "properties": {
                "failureThreshold": {
                    "type": "integer"
                },
                "httpGet": {
                    "type": "object",
                    "properties": {
                        "path": {
                            "type": "string"
                        },
                        "port": {
                            "type": "string"
                        }
                    },
                    "additionalProperties": false
                },
                "periodSeconds": {
                    "type": "integer"
                }
            },
            "additionalProperties": false
        },
        "resources": {
            "type": "object",
            "properties": {
                "limits": {
                    "type": "object",
                    "properties": {
                        "cpu": {
                            "type": "string"
                        },
                        "memory": {
                            "type": "string"
                        }
                    },
                    "additionalProperties": false
                },
                "requests": {
                    "type": "object",
                    "properties": {
                        "cpu": {
                            "type": "string"
                        },
                        "memory": {
                            "type": "string"
                        }
                    },
                    "additionalProperties": false
                }
            },
            "additionalProperties": false
        },
        "restartOnConfigChange": {
            "type": "boolean"
        },
        "securityContext": {
            "type": "object",
            "properties": {
                "runAsNonRoot": {
                    "type": "boolean"
                },
                "runAsUser": {
                    "type": "integer"
                }
            },
            "additionalProperties": false
        },
        "service": {
            "type": "object",
            "properties": {
                "port": {
                    "type": "integer"
                },
                "type": {
                    "type": "string"
                }
            },
            "additionalProperties": false
        },
        "serviceAccount": {
            "type": "object",
            "properties": {
                "annotations": {
                    "type": "object",
                    "additionalProperties": false
                },
                "automount": {
                    "type": "boolean"
                },
                "create": {
                    "type": "boolean"
                },
                "name": {
                    "type": "string"
                }
            },
            "additionalProperties": false
        },
        "startupProbe": {
            "type": "object",
            "properties": {
                "failureThreshold": {
                    "type": "integer"
                },
                "httpGet": {
                    "type": "object",
                    "properties": {
                        "path": {
                            "type": "string"
                        },
                        "port": {
                            "type": "string"
                        }
                    },
                    "additionalProperties": false
                },
                "periodSeconds": {
                    "type": "integer"
                }
            },
            "additionalProperties": false
        },
        "tolerations": {
            "type": "array"
        },
        "tracing": {
            "type": "object",
            "properties": {
                "otlp": {
                    "type": "object",
                    "properties": {
                        "enabled": {
                            "type": "boolean"
                        },
                        "protocol": {
                            "type": "string"
                        },
                        "server": {
                            "type": "object",
                            "properties": {
                                "host": {
                                    "type": "string"
                                },
                                "port": {
                                    "type": "integer"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "additionalProperties": false
                }
            },
            "additionalProperties": false
        },
        "volumeMounts": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "mountPath": {
                        "type": "string"
                    },
                    "name": {
                        "type": "string"
                    },
                    "readOnly": {
                        "type": "boolean"
                    }
                },
                "additionalProperties": false
            }
        },
        "volumes": {
            "type": "array"
        },
        "worker": {
            "$ref": "config_schema.json",
            "type": "object",
            "properties": {
                "api": {
                    "type": "object",
                    "properties": {
                        "url": {
                            "type": "string"
                        }
                    },
                    "additionalProperties": false
                },
                "env": {
                    "type": "object",
                    "properties": {
                        "sources": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "kind": {
                                        "type": "string"
                                    },
                                    "module": {
                                        "type": "string"
                                    }
                                },
                                "additionalProperties": false
                            }
                        }
                    },
                    "additionalProperties": false
                },
                "logging": {
                    "type": "object",
                    "properties": {
                        "graylog": {
                            "type": "object",
                            "properties": {
                                "enabled": {
                                    "type": "boolean"
                                },
                                "url": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        },
                        "level": {
                            "type": "string"
                        }
                    },
                    "additionalProperties": false
                },
                "scratch": {
                    "type": "object",
                    "properties": {
                        "repositories": {
                            "type": "array"
                        },
                        "root": {
                            "type": "string"
                        }
                    },
                    "additionalProperties": false
                },
                "stomp": {
                    "type": "object",
                    "properties": {
                        "auth": {
                            "type": "object",
                            "properties": {
                                "password": {
                                    "type": "string"
                                },
                                "username": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        },
                        "enabled": {
                            "type": "boolean"
                        },
                        "url": {
                            "type": "string"
                        }
                    },
                    "additionalProperties": false
                }
            },
            "additionalProperties": false
        }
    },
    "additionalProperties": false,
    "$defs": {
        "config_schema.json": {
            "$id": "config_schema.json",
            "title": "ApplicationConfig",
            "description": "Config for the worker application as a whole. Root of\nconfig tree.",
            "type": "object",
            "properties": {
                "api": {
                    "$ref": "#/$defs/RestConfig"
                },
                "auth_token_path": {
                    "title": "Auth Token Path",
                    "anyOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "null"
                        }
                    ]
                },
                "env": {
                    "$ref": "#/$defs/EnvironmentConfig"
                },
                "logging": {
                    "$ref": "#/$defs/LoggingConfig"
                },
                "numtracker": {
                    "anyOf": [
                        {
                            "$ref": "#/$defs/NumtrackerConfig"
                        },
                        {
                            "type": "null"
                        }
                    ]
                },
                "oidc": {
                    "anyOf": [
                        {
                            "$ref": "#/$defs/OIDCConfig"
                        },
                        {
                            "type": "null"
                        }
                    ]
                },
                "scratch": {
                    "anyOf": [
                        {
                            "$ref": "#/$defs/ScratchConfig"
                        },
                        {
                            "type": "null"
                        }
                    ]
                },
                "stomp": {
                    "$ref": "#/$defs/StompConfig"
                }
            },
            "additionalProperties": false,
            "$defs": {
                "BasicAuthentication": {
                    "title": "BasicAuthentication",
                    "description": "User credentials for basic authentication",
                    "type": "object",
                    "required": [
                        "username",
                        "password"
                    ],
                    "properties": {
                        "password": {
                            "title": "Password",
                            "description": "Password to verify user's identity",
                            "type": "string"
                        },
                        "username": {
                            "title": "Username",
                            "description": "Unique identifier for user",
                            "type": "string"
                        }
                    },
                    "additionalProperties": false
                },
                "CORSConfig": {
                    "title": "CORSConfig",
                    "type": "object",
                    "required": [
                        "origins"
                    ],
                    "properties": {
                        "allow_credentials": {
                            "title": "Allow Credentials",
                            "default": false,
                            "type": "boolean"
                        },
                        "allow_headers": {
                            "title": "Allow Headers",
                            "default": [
                                "*"
                            ],
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        },
                        "allow_methods": {
                            "title": "Allow Methods",
                            "default": [
                                "*"
                            ],
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        },
                        "origins": {
                            "title": "Origins",
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        }
                    },
                    "additionalProperties": false
                },
                "EnvironmentConfig": {
                    "title": "EnvironmentConfig",
                    "description": "Config for the RunEngine environment",
                    "type": "object",
                    "properties": {
                        "events": {
                            "$ref": "#/$defs/WorkerEventConfig"
                        },
                        "metadata": {
                            "anyOf": [
                                {
                                    "$ref": "#/$defs/MetadataConfig"
                                },
                                {
                                    "type": "null"
                                }
                            ]
                        },
                        "sources": {
                            "title": "Sources",
                            "default": [
                                {
                                    "kind": "planFunctions",
                                    "module": "dodal.plans"
                                },
                                {
                                    "kind": "planFunctions",
                                    "module": "dodal.plan_stubs.wrapped"
                                }
                            ],
                            "type": "array",
                            "items": {
                                "$ref": "#/$defs/Source"
                            }
                        }
                    },
                    "additionalProperties": false
                },
                "GraylogConfig": {
                    "title": "GraylogConfig",
                    "type": "object",
                    "properties": {
                        "enabled": {
                            "title": "Enabled",
                            "default": false,
                            "type": "boolean"
                        },
                        "url": {
                            "title": "Url",
                            "default": "tcp://localhost:5555",
                            "type": "string",
                            "minLength": 1
                        }
                    },
                    "additionalProperties": false
                },
                "LoggingConfig": {
                    "title": "LoggingConfig",
                    "type": "object",
                    "properties": {
                        "graylog": {
                            "default": {
                                "enabled": false,
                                "url": "tcp://localhost:5555"
                            },
                            "$ref": "#/$defs/GraylogConfig"
                        },
                        "level": {
                            "title": "Level",
                            "default": "INFO",
                            "type": "string",
                            "enum": [
                                "NOTSET",
                                "DEBUG",
                                "INFO",
                                "WARNING",
                                "ERROR",
                                "CRITICAL"
                            ]
                        }
                    },
                    "additionalProperties": false
                },
                "MetadataConfig": {
                    "title": "MetadataConfig",
                    "type": "object",
                    "required": [
                        "instrument_session",
                        "instrument"
                    ],
                    "properties": {
                        "instrument": {
                            "title": "Instrument",
                            "type": "string"
                        },
                        "instrument_session": {
                            "title": "Instrument Session",
                            "type": "string"
                        }
                    },
                    "additionalProperties": false
                },
                "NumtrackerConfig": {
                    "title": "NumtrackerConfig",
                    "type": "object",
                    "properties": {
                        "url": {
                            "title": "Url",
                            "default": "http://localhost:8002/graphql",
                            "type": "string",
                            "maxLength": 2083,
                            "minLength": 1
                        }
                    },
                    "additionalProperties": false
                },
                "OIDCConfig": {
                    "title": "OIDCConfig",
                    "type": "object",
                    "required": [
                        "well_known_url",
                        "client_id"
                    ],
                    "properties": {
                        "client_audience": {
                            "title": "Client Audience",
                            "description": "Client Audience(s)",
                            "default": "blueapi",
                            "type": "string"
                        },
                        "client_id": {
                            "title": "Client Id",
                            "description": "Client ID",
                            "type": "string"
                        },
                        "well_known_url": {
                            "title": "Well Known Url",
                            "description": "URL to fetch OIDC config from the provider",
                            "type": "string"
                        }
                    },
                    "additionalProperties": false
                },
                "RestConfig": {
                    "title": "RestConfig",
                    "type": "object",
                    "properties": {
                        "cors": {
                            "anyOf": [
                                {
                                    "$ref": "#/$defs/CORSConfig"
                                },
                                {
                                    "type": "null"
                                }
                            ]
                        },
                        "url": {
                            "title": "Url",
                            "default": "http://localhost:8000/",
                            "type": "string",
                            "maxLength": 2083,
                            "minLength": 1
                        }
                    },
                    "additionalProperties": false
                },
                "ScratchConfig": {
                    "title": "ScratchConfig",
                    "type": "object",
                    "properties": {
                        "repositories": {
                            "title": "Repositories",
                            "description": "Details of repositories to be cloned and imported into blueapi",
                            "type": "array",
                            "items": {
                                "$ref": "#/$defs/ScratchRepository"
                            }
                        },
                        "required_gid": {
                            "title": "Required Gid",
                            "description": "\nRequired owner GID for the scratch directory. If supplied, the setup-scratch\ncommand will check the scratch area ownership and raise an error if it is\nnot owned by \u003cGID\u003e, or if it does not have SGID permission bit set.\n",
                            "anyOf": [
                                {
                                    "type": "integer"
                                },
                                {
                                    "type": "null"
                                }
                            ]
                        },
                        "root": {
                            "title": "Root",
                            "description": "The root directory of the scratch area, all repositories will be cloned under this directory.",
                            "default": "/tmp/scratch/blueapi",
                            "type": "string"
                        }
                    },
                    "additionalProperties": false
                },
                "ScratchRepository": {
                    "title": "ScratchRepository",
                    "type": "object",
                    "properties": {
                        "name": {
                            "title": "Name",
                            "description": "Unique name for this repository in the scratch directory",
                            "default": "example",
                            "type": "string"
                        },
                        "remote_url": {
                            "title": "Remote Url",
                            "description": "URL to clone from",
                            "default": "https://github.com/example/example.git",
                            "type": "string"
                        }
                    },
                    "additionalProperties": false
                },
                "Source": {
                    "title": "Source",
                    "type": "object",
                    "required": [
                        "kind",
                        "module"
                    ],
                    "properties": {
                        "kind": {
                            "$ref": "#/$defs/SourceKind"
                        },
                        "module": {
                            "title": "Module",
                            "anyOf": [
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "string"
                                }
                            ]
                        }
                    },
                    "additionalProperties": false
                },
                "SourceKind": {
                    "title": "SourceKind",
                    "type": "string",
                    "enum": [
                        "planFunctions",
                        "deviceFunctions",
                        "dodal"
                    ]
                },
                "StompConfig": {
                    "title": "StompConfig",
                    "description": "Config for connecting to stomp broker",
                    "type": "object",
                    "properties": {
                        "auth": {
                            "description": "Auth information for communicating with STOMP broker, if required",
                            "anyOf": [
                                {
                                    "$ref": "#/$defs/BasicAuthentication"
                                },
                                {
                                    "type": "null"
                                }
                            ]
                        },
                        "enabled": {
                            "title": "Enabled",
                            "description": "True if blueapi should connect to stomp for asynchronous event publishing",
                            "default": false,
                            "type": "boolean"
                        },
                        "url": {
                            "title": "Url",
                            "default": "tcp://localhost:61613",
                            "type": "string",
                            "minLength": 1
                        }
                    },
                    "additionalProperties": false
                },
                "WorkerEventConfig": {
                    "title": "WorkerEventConfig",
                    "description": "Config for event broadcasting via the message bus",
                    "type": "object",
                    "properties": {
                        "broadcast_status_events": {
                            "title": "Broadcast Status Events",
                            "default": true,
                            "type": "boolean"
                        }
                    },
                    "additionalProperties": false
                }
            }
        }
    }
}
