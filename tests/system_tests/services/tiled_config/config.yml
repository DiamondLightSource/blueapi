database:
  uri: sqlite:////storage/auth.db
  init_if_not_exists: true
authentication:
  # Any HTTP client that can connect can read, an API key is still required to write.
  allow_anonymous_access: true
  providers:
    - provider: keycloak_oidc
      authenticator: tiled.authenticators:ProxiedOIDCAuthenticator
      args:
        audience: account
        client_id: tiled
        device_flow_client_id: tiled-cli
        well_known_uri: "http://localhost:8081/realms/master/.well-known/openid-configuration"
        confirmation_message: "You have logged in with authn.diamond.ac.uk as {id}."
trees:
  - path: /
    tree: catalog
    args:
      uri: "sqlite:////storage/catalog.db"
      writable_storage: "sqlite:////storage/catalog.db"
      init_if_not_exists: true

access_control:
  access_policy: "config.dls:DiamondOpenPolicyAgentAuthorizationPolicy"
  args:
    authorization_provider: "http://localhost:8181/v1/data/diamond/policy/"
    token_audience: account
    empty_access_blob_public: true
