include:
  - ../../example-services/compose.yaml

services:
  numtracker:
    image: ghcr.io/diamondlightsource/numtracker:1.0.1
    ports:
      - "8406:8000"
    post_start:
      - command: /app/numtracker client configure adsim --directory '/tmp/' --scan '{instrument}-{scan_number}' --detector '{instrument}-{scan_number}-{detector}' --number 43

  rabbitmq:
    image: docker.io/rabbitmq:4.0-management
    ports:
      - "5672:5672"
      - "15672:15672"
      - "61613:61613"
    volumes:
      - type: bind
        source: ./services/rabbitmq_plugins
        target: /etc/rabbitmq/enabled_plugins

  tiled:
    image: ghcr.io/bluesky/tiled:0.1.0-b29
    ports:
      - "8407:8000"
    environment:
      - TILED_SINGLE_USER_API_KEY=${TILED_SINGLE_USER_API_KEY}
    volumes:
      - type: bind
        source: ./services/tiled_config
        target: /deploy/config
